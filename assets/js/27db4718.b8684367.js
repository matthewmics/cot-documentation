"use strict";(self.webpackChunkcot_docs=self.webpackChunkcot_docs||[]).push([[276],{1989:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tech-stack/2typeorm","title":"TypeORM","description":"TypeORM is an Object-Relational Mapping (ORM) library that helps developers interact with databases using TypeScript or JavaScript. It supports various databases like MySQL, PostgreSQL, SQLite, and MongoDB. In this guide, we will integrate TypeORM with NestJS.","source":"@site/docs/tech-stack/2typeorm.md","sourceDirName":"tech-stack","slug":"/tech-stack/2typeorm","permalink":"/cot-documentation/docs/tech-stack/2typeorm","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tech-stack/2typeorm.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"NestJS","permalink":"/cot-documentation/docs/tech-stack/1nestjs"},"next":{"title":"Vite React","permalink":"/cot-documentation/docs/tech-stack/3vite-react"}}');var s=n(4848),i=n(8453);const o={},a="TypeORM",l={},c=[{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Creating an Entity",id:"creating-an-entity",level:2},{value:"Creating a Repository",id:"creating-a-repository",level:2},{value:"Using the Repository in a Service",id:"using-the-repository-in-a-service",level:2},{value:"Creating a Controller",id:"creating-a-controller",level:2},{value:"Database Migrations",id:"database-migrations",level:2},{value:"Generating Migrations",id:"generating-migrations",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"typeorm",children:"TypeORM"})}),"\n",(0,s.jsx)(r.p,{children:"TypeORM is an Object-Relational Mapping (ORM) library that helps developers interact with databases using TypeScript or JavaScript. It supports various databases like MySQL, PostgreSQL, SQLite, and MongoDB. In this guide, we will integrate TypeORM with NestJS."}),"\n",(0,s.jsx)(r.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(r.p,{children:"To use TypeORM in NestJS, install the required dependencies:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"npm install @nestjs/typeorm typeorm mysql2\n"})}),"\n",(0,s.jsx)(r.p,{children:"Replace mysql2 with the database driver for your preferred database (e.g., pg for PostgreSQL, sqlite3 for SQLite, etc.)."}),"\n",(0,s.jsx)(r.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(r.p,{children:"Modify the app.module.ts file to configure TypeORM:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"import { Module } from '@nestjs/common';\r\nimport { TypeOrmModule } from '@nestjs/typeorm';\r\nimport { User } from './users/user.entity';\r\nimport { UsersModule } from './users/users.module';\r\n\r\n@Module({\r\n  imports: [\r\n    TypeOrmModule.forRoot({\r\n      type: 'mysql',\r\n      host: 'localhost',\r\n      port: 3306,\r\n      username: 'root',\r\n      password: 'password',\r\n      database: 'test_db',\r\n      entities: [User],\r\n      synchronize: true, // Set to false in production\r\n    }),\r\n    UsersModule,\r\n  ],\r\n})\r\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"creating-an-entity",children:"Creating an Entity"}),"\n",(0,s.jsx)(r.p,{children:"Entities define database table structures. Create a user.entity.ts file:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"import { Entity, PrimaryGeneratedColumn, Column } from 'typeorm';\r\n\r\n@Entity()\r\nexport class User {\r\n  @PrimaryGeneratedColumn()\r\n  id: number;\r\n\r\n  @Column()\r\n  name: string;\r\n\r\n  @Column({ unique: true })\r\n  email: string;\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"creating-a-repository",children:"Creating a Repository"}),"\n",(0,s.jsx)(r.p,{children:"A repository allows interaction with the database. Update users.module.ts:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"import { Module } from '@nestjs/common';\r\nimport { TypeOrmModule } from '@nestjs/typeorm';\r\nimport { User } from './user.entity';\r\nimport { UsersService } from './users.service';\r\nimport { UsersController } from './users.controller';\r\n\r\n@Module({\r\n  imports: [TypeOrmModule.forFeature([User])],\r\n  controllers: [UsersController],\r\n  providers: [UsersService],\r\n})\r\nexport class UsersModule {}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"using-the-repository-in-a-service",children:"Using the Repository in a Service"}),"\n",(0,s.jsx)(r.p,{children:"Create users.service.ts to handle database operations:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"import { Injectable } from '@nestjs/common';\r\nimport { InjectRepository } from '@nestjs/typeorm';\r\nimport { Repository } from 'typeorm';\r\nimport { User } from './user.entity';\r\n\r\n@Injectable()\r\nexport class UsersService {\r\n  constructor(\r\n    @InjectRepository(User)\r\n    private usersRepository: Repository<User>,\r\n  ) {}\r\n\r\n  async createUser(name: string, email: string): Promise<User> {\r\n    const user = this.usersRepository.create({ name, email });\r\n    return this.usersRepository.save(user);\r\n  }\r\n\r\n  async findAll(): Promise<User[]> {\r\n    return this.usersRepository.find();\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"creating-a-controller",children:"Creating a Controller"}),"\n",(0,s.jsx)(r.p,{children:"Create users.controller.ts to expose API routes:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"import { Controller, Get, Post, Body } from '@nestjs/common';\r\nimport { UsersService } from './users.service';\r\nimport { User } from './user.entity';\r\n\r\n@Controller('users')\r\nexport class UsersController {\r\n  constructor(private readonly usersService: UsersService) {}\r\n\r\n  @Post()\r\n  create(@Body() body: { name: string; email: string }): Promise<User> {\r\n    return this.usersService.createUser(body.name, body.email);\r\n  }\r\n\r\n  @Get()\r\n  findAll(): Promise<User[]> {\r\n    return this.usersService.findAll();\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"database-migrations",children:"Database Migrations"}),"\n",(0,s.jsx)(r.p,{children:"To track schema changes, use migrations instead of synchronize: true. First, install the CLI tool:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"npm install -g typeorm\n"})}),"\n",(0,s.jsx)(r.p,{children:"Modify ormconfig.json:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'{\r\n  "type": "mysql",\r\n  "host": "localhost",\r\n  "port": 3306,\r\n  "username": "root",\r\n  "password": "password",\r\n  "database": "test_db",\r\n  "entities": ["dist/**/*.entity.js"],\r\n  "migrations": ["dist/migrations/*.js"],\r\n  "cli": {\r\n    "migrationsDir": "src/migrations"\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"generating-migrations",children:"Generating Migrations"}),"\n",(0,s.jsx)(r.p,{children:"To generate a new migration, run the following command:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"typeorm migration:generate -n MigrationName\n"})}),"\n",(0,s.jsx)(r.p,{children:"This will create a new migration file inside the src/migrations directory. To apply the migration, run:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"typeorm migration:run\n"})}),"\n",(0,s.jsx)(r.p,{children:"To revert the last migration, run:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"typeorm migration:revert\n"})}),"\n",(0,s.jsx)(r.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(r.p,{children:"Integrating TypeORM with NestJS provides a structured approach to handling database operations. This guide covered setting up TypeORM, creating entities, repositories, services, controllers, handling database migrations, and generating migrations. Keep exploring to enhance your NestJS applications!"})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var t=n(6540);const s={},i=t.createContext(s);function o(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);