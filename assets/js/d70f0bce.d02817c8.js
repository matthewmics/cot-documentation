"use strict";(self.webpackChunkcot_docs=self.webpackChunkcot_docs||[]).push([[900],{6039:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"system-architecture/pm2","title":"PM2","description":"PM2 is a production process manager for Node.js applications. It helps you manage your application processes, monitor their performance, and handle logs effectively. Using PM2 is an essential part of managing applications in production environments, such as for deploying NestJS and React apps on a Linux server.","source":"@site/docs/system-architecture/2_pm2.md","sourceDirName":"system-architecture","slug":"/system-architecture/pm2","permalink":"/cot-documentation/docs/system-architecture/pm2","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/system-architecture/2_pm2.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"NVM","permalink":"/cot-documentation/docs/system-architecture/nvm"},"next":{"title":"NGINX","permalink":"/cot-documentation/docs/system-architecture/nginx"}}');var t=i(4848),s=i(8453);const r={},a="PM2",l={},c=[{value:"Installation",id:"installation",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"COT Production Configuration",id:"cot-production-configuration",level:2},{value:"Test Server Configuration",id:"test-server-configuration",level:2},{value:"Managing Applications",id:"managing-applications",level:2},{value:"List Running Applications",id:"list-running-applications",level:3},{value:"Restarting an Application",id:"restarting-an-application",level:3},{value:"Stopping an Application",id:"stopping-an-application",level:3},{value:"Deleting an Application",id:"deleting-an-application",level:3},{value:"Monitoring Applications",id:"monitoring-applications",level:2},{value:"Real-time Monitoring",id:"real-time-monitoring",level:3},{value:"Viewing Logs",id:"viewing-logs",level:3},{value:"View All Logs",id:"view-all-logs",level:3},{value:"Log Management",id:"log-management",level:2},{value:"Log Rotation",id:"log-rotation",level:3},{value:"Conclusion",id:"conclusion",level:2}];function p(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"pm2",children:"PM2"})}),"\n",(0,t.jsx)(e.p,{children:"PM2 is a production process manager for Node.js applications. It helps you manage your application processes, monitor their performance, and handle logs effectively. Using PM2 is an essential part of managing applications in production environments, such as for deploying NestJS and React apps on a Linux server."}),"\n",(0,t.jsx)(e.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(e.p,{children:"To install PM2 globally on your system, you need to use npm:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"npm install pm2 -g\n"})}),"\n",(0,t.jsx)(e.p,{children:"This command installs PM2 globally, making it accessible from anywhere on your system."}),"\n",(0,t.jsx)(e.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,t.jsx)(e.p,{children:"Once installed, PM2 allows you to easily start your Node.js applications in the background. To start an application, use the following command:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 start app.js\n"})}),"\n",(0,t.jsx)(e.p,{children:"Replace app.js with the entry point to your application (for example, main.js for a NestJS app or server.js for a Vite React app)."}),"\n",(0,t.jsx)(e.h2,{id:"cot-production-configuration",children:"COT Production Configuration"}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsx)(e.p,{children:"This is our current production configuration in our server"})}),"\n",(0,t.jsxs)(e.p,{children:["For your production server, use the following ",(0,t.jsx)(e.code,{children:"pm2.json"})," configuration, which is located at ",(0,t.jsx)(e.code,{children:"/api/pm2.json"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'{\r\n  "apps": [\r\n    {\r\n      "name": "api",\r\n      "script": "dist/main.js",\r\n      "wait_ready": true,\r\n      "listen_timeout": 15000,\r\n      "kill_timeout": 120000,\r\n      "exec_mode": "cluster",\r\n      "instances": 2\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:"To start the application in production, use this command:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 start /api/pm2.json\n"})}),"\n",(0,t.jsxs)(e.p,{children:["This will use the configuration file to start the application in cluster mode with 2 instances of the app running. The ",(0,t.jsx)(e.code,{children:"listen_timeout"})," is set to 15 seconds and ",(0,t.jsx)(e.code,{children:"kill_timeout"})," to 2 minutes to allow graceful shutdown and restarts."]}),"\n",(0,t.jsx)(e.h2,{id:"test-server-configuration",children:"Test Server Configuration"}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsx)(e.p,{children:"This is our current test configuration in our server"})}),"\n",(0,t.jsxs)(e.p,{children:["For your test environment, use the following ",(0,t.jsx)(e.code,{children:"pm2ex.json"})," configuration, which is located at ",(0,t.jsx)(e.code,{children:"api/pm2ex.json"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'{\r\n  "apps": [\r\n    {\r\n      "name": "apiex",\r\n      "script": "dist/main.js",\r\n      "wait_ready": true,\r\n      "listen_timeout": 15000,\r\n      "kill_timeout": 60000,\r\n      "exec_mode": "cluster",\r\n      "instances": 2\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:"To start the application in the test environment, use this command:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 start api/pm2ex.json\n"})}),"\n",(0,t.jsx)(e.p,{children:"This configuration is similar to the production environment but with a shorter kill_timeout of 1 minute."}),"\n",(0,t.jsx)(e.h2,{id:"managing-applications",children:"Managing Applications"}),"\n",(0,t.jsx)(e.p,{children:"PM2 offers several commands to help you manage running applications:"}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsxs)(e.p,{children:["Please do note that ",(0,t.jsx)(e.code,{children:"api"})," is for production and ",(0,t.jsx)(e.code,{children:"apiex"})," is for test server"]})}),"\n",(0,t.jsx)(e.h3,{id:"list-running-applications",children:"List Running Applications"}),"\n",(0,t.jsx)(e.p,{children:"To see a list of all running applications:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 list\n"})}),"\n",(0,t.jsx)(e.h3,{id:"restarting-an-application",children:"Restarting an Application"}),"\n",(0,t.jsx)(e.p,{children:"To restart an application:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 restart api\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 restart apiex\n"})}),"\n",(0,t.jsxs)(e.admonition,{type:"warning",children:[(0,t.jsx)(e.p,{children:"pm2 restart will have downtime so we should use this instead"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 reload api\n"})}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 reload apiex\n"})}),(0,t.jsx)(e.p,{children:"I have configured the code already to make restart graceful so we have 0 downtime during deployment"})]}),"\n",(0,t.jsx)(e.h3,{id:"stopping-an-application",children:"Stopping an Application"}),"\n",(0,t.jsx)(e.p,{children:"To stop a running application:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 stop api\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 stop apiex\n"})}),"\n",(0,t.jsx)(e.h3,{id:"deleting-an-application",children:"Deleting an Application"}),"\n",(0,t.jsx)(e.p,{children:"To delete an application from PM2\u2019s process list:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 delete api\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 delete apiex\n"})}),"\n",(0,t.jsx)(e.h2,{id:"monitoring-applications",children:"Monitoring Applications"}),"\n",(0,t.jsx)(e.p,{children:"PM2 provides easy monitoring tools for real-time performance and logs:"}),"\n",(0,t.jsx)(e.h3,{id:"real-time-monitoring",children:"Real-time Monitoring"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 monit\n"})}),"\n",(0,t.jsx)(e.h3,{id:"viewing-logs",children:"Viewing Logs"}),"\n",(0,t.jsx)(e.p,{children:"You can view the logs for a specific application by running:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 logs api\n"})}),"\n",(0,t.jsx)(e.h3,{id:"view-all-logs",children:"View All Logs"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 logs\n"})}),"\n",(0,t.jsx)(e.h2,{id:"log-management",children:"Log Management"}),"\n",(0,t.jsx)(e.p,{children:"PM2 automatically manages logs for your applications. However, you can set up log rotation to prevent logs from becoming too large:"}),"\n",(0,t.jsx)(e.h3,{id:"log-rotation",children:"Log Rotation"}),"\n",(0,t.jsx)(e.p,{children:"PM2 provides a module for log rotation. Install it by running:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 install pm2-logrotate\n"})}),"\n",(0,t.jsx)(e.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(e.p,{children:"PM2 is a powerful tool that simplifies the management of Node.js applications, especially when deploying applications like NestJS or Vite React. It provides essential features like background processing, process monitoring, log management, and automatic restart. With PM2, you can ensure that your applications remain running efficiently in production environments."}),"\n",(0,t.jsx)(e.p,{children:"To start your applications in production or test environments, simply use:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pm2 start /api/pm2.json    # For production\r\npm2 start api/pm2ex.json    # For test\n"})}),"\n",(0,t.jsx)(e.p,{children:"These commands will start your applications with the appropriate configuration files for each environment."})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>a});var o=i(6540);const t={},s=o.createContext(t);function r(n){const e=o.useContext(s);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),o.createElement(s.Provider,{value:e},n.children)}}}]);